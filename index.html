<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard WEBMAP DANIEL ARYA</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .dashboard-header {
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            color: white;
            padding: 10px 0;
            margin-bottom: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #map-container {
            position: relative;
            height: calc(100vh - 150px);
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .legend {
            position: absolute;
            bottom: 20px;
            right: 25px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            max-width: 250px;
        }
        .legend h5 {
            margin-top: 0;
            color: #2c3e50;
            font-weight: 400;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .legend-item {
            display:flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .legend-color {
            width: 25px;
            height: 25px;
            margin-right: 15px;
            border-radius: 8px;
        }
        .sidebar {
            background-color: white;
            border-radius: 8px;
            padding: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            height: calc(100vh - 150px);
            overflow-y: hidden;
        }
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            border-left: 4px solid #4ca1af;
        }
        .stat-card h5 {
            color: #2c3e50;
            font-size: 7px;
            margin-bottom: 5px;
        }
        .stat-card p {
            font-size: 15px;
            font-weight: 600;
            color: #4ca1af;
            margin-bottom: 0;
        }
        .nav-pills .nav-link.active {
            background-color: #4ca1af;
        }
        .nav-pills .nav-link {
            color: #2c3e50;
        }
        .tab-content {
            padding: 15px 0;
        }
        .custom-control-label {
            cursor: pointer;
        }
        /* Style for image gallery in popup */
        .popup-image {
            max-width: 100%;
            max-height: 200px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .popup-image-container {
            text-align: center;
            margin-bottom: 15px;
        }
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-12">
                    <h1 style="font-size: 1rem; line-height: 1; margin-bottom: 5px; padding-top: 5px; "></h1>
                    <h1><i class="fas fa-map-marked-alt me-2"></i> 
                    Peta Sebaran Tempat Wisata di Kabupaten dan Kota Sukabumi
                </h1>
                <p style="font-size: 1rem; margin-bottom: 0; padding-bottom: 5px; padding-left: 65px;">
                    Dengan analisis Kemiringan Lereng untuk Keamanan dan Kenyamanan Wisatawan
                </p>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
<div class="col-md-3">
    <div class="sidebar">
        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-data-tab" data-bs-toggle="pill" data-bs-target="#pills-data" type="button" role="tab">Data Sources</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-metadata-tab" data-bs-toggle="pill" data-bs-target="#pills-metadata" type="button" role="tab">Data Description</button>
            </li>
        </ul>
        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pills-data" role="tabpanel">
                <h5 class="mb-3"><i class="fas fa-database me-2"></i> Sumber Data</h5>
                <div class="mb-4">
                    <h6>Data Kemiringan Lereng</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-map-marked-alt me-2"></i> Sumber: DEM Nasional</li>
                        <li>https://tanahair.indonesia.go.id </li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6>Data Administrasi</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-map me-2"></i> Sumber: BIG (Badan Informasi Geospasial)</li>
                        <li>https://geoservices.big.go.id</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6>Data Jaringan Jalan</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-road me-2"></i> Sumber: OpenStreetMap</li>
                        <li><i class="fas fa-calendar-alt me-2"></i> Update Terakhir: Januari 2024</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6>Data Tempat Wisata</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-umbrella-beach me-2"></i> Sumber: Dinas Pariwisata Sukabumi</li>
                        <li><i class="fas fa-calendar-alt me-2"></i> Tahun: 2023</li>
                    </ul>
                </div>
            </div>
            
            <div class="tab-pane fade" id="pills-metadata" role="tabpanel">
                <h5 class="mb-3"><i class="fas fa-info-circle me-2"></i> Deskripsi Data</h5>
                
                <div class="mb-4">
                    <h6>Klasifikasi Kemiringan Lereng</h6>
                    <ul>
                        <li>Datar (0-8%)</li>
                        <li>Landai (8-15%)</li>
                        <li>Agak Curam (15-25%)</li>
                        <li>Curam (25-45%)</li>
                        <li>Sangat Curam (>45%)</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6>Layer Peta</h6>
                    <ul>
                        <li>Peta Kemiringan Lereng</li>
                        <li>Batas Administrasi Kecamatan</li>
                        <li>Jaringan Jalan Kabupaten/Kota</li>
                        <li>Sebaran Lokasi Objek Wisata</li>
                    </ul>
                </div>     
               
                <div class="mb-4">
                    <h6>Dibuat Oleh :</h6>
                    <ul>
                        <p>Muhammad Daniel Arya Permana <br>23/521762/SV/23492 </br></p>
                
                    </ul>
                </div>     
            </div>
        </div>
        
        <hr>
        
    
    </div>
</div>
            
            <!-- Map Container -->
            <div class="col-md-9">
                <div id="map-container">
                    <div id="map"></div>
                    
                    <!-- Legend -->
                    <div class="legend">
                        <h5><i class="fas fa-layer-group me-2"></i> Klasifikasi Kemiringan Lereng</h5>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4daf4a;"></div>
                            <span>Datar</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #a6d854;"></div>
                            <span>Landai</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffff33;"></div>
                            <span>Agak Curam</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ff7710;"></div>
                            <span>Curam</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #e41a1c;"></div>
                            <span>Sangat Curam</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
    <script src="js/leaflet-measure.js"></script>
    <script src="data/JaringanJalan_2.js"></script>
    <script src="data/BatasKecamatan_3.js"></script>
    <script src="data/SebaranObjekWisata_4.js"></script>
    
    <script>
        // Initialize the map
        var map = L.map('map', {
            zoomControl: false, 
            maxZoom: 28, 
            minZoom: 1

        }).fitBounds([[-7.625889505784997,105.92424266122242],[-6.498342408267721,107.45548161335917]]);
        
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        
        // Helper functions
        function removeEmptyRowsFromPopupContent(content, feature) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var rows = tempDiv.querySelectorAll('tr');
            for (var i = 0; i < rows.length; i++) {
                var td = rows[i].querySelector('td.visible-with-data');
                var key = td ? td.id : '';
                if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                    rows[i].parentNode.removeChild(rows[i]);
                }
            }
            return tempDiv.innerHTML;
        }
        
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            if (tempDiv.querySelector('td img')) {
                popup._contentNode.classList.add('media');
                setTimeout(function() {
                    popup.update();
                }, 10);
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        
        // Add controls
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        
        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);
        
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        
        var bounds_group = new L.featureGroup([]);
        
        function setBounds() {
            // Can be implemented if needed
        }
        
        // Add base layers
        map.createPane('pane_ESRIGraylight_0');
        map.getPane('pane_ESRIGraylight_0').style.zIndex = 400;
        var layer_ESRIGraylight_0 = L.tileLayer('https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
            pane: 'pane_ESRIGraylight_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 20
        });
        map.addLayer(layer_ESRIGraylight_0);
        
        // Add slope classification layer
        map.createPane('pane_KlasifikasiKemiringanLereng_1');
        map.getPane('pane_KlasifikasiKemiringanLereng_1').style.zIndex = 401;
        var img_KlasifikasiKemiringanLereng_1 = 'data/KlasifikasiKemiringanLereng_1.png';
        var img_bounds_KlasifikasiKemiringanLereng_1 = [[-7.440082103468432,106.368080757919],[-6.712840217078414,107.06727927578538]];
        var layer_KlasifikasiKemiringanLereng_1 = new L.imageOverlay(img_KlasifikasiKemiringanLereng_1,
                                              img_bounds_KlasifikasiKemiringanLereng_1,
                                              {pane: 'pane_KlasifikasiKemiringanLereng_1'});
        bounds_group.addLayer(layer_KlasifikasiKemiringanLereng_1);
        map.addLayer(layer_KlasifikasiKemiringanLereng_1);
        
        // Road network layer
        function pop_JaringanJalan_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Road ID:</strong> ' + (feature.properties['osm_id'] !== null ? autolinker.link(String(feature.properties['osm_id'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Type:</strong> ' + (feature.properties['fclass'] !== null ? autolinker.link(String(feature.properties['fclass'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Name:</strong> ' + (feature.properties['name'] !== null ? autolinker.link(String(feature.properties['name'])) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function(e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }
        
        function style_JaringanJalan_2_0() {
            return {
                pane: 'pane_JaringanJalan_2',
                opacity: 1,
                color: 'rgba(177,69,30,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        
        map.createPane('pane_JaringanJalan_2');
        map.getPane('pane_JaringanJalan_2').style.zIndex = 402;
        map.getPane('pane_JaringanJalan_2').style['mix-blend-mode'] = 'normal';
        var layer_JaringanJalan_2 = new L.geoJson(json_JaringanJalan_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_JaringanJalan_2',
            layerName: 'layer_JaringanJalan_2',
            pane: 'pane_JaringanJalan_2',
            onEachFeature: pop_JaringanJalan_2,
            style: style_JaringanJalan_2_0,
        });
        bounds_group.addLayer(layer_JaringanJalan_2);
        map.addLayer(layer_JaringanJalan_2);
        
        // District boundaries layer
        function pop_BatasKecamatan_3(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>District:</strong> ' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC'])) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2"><strong>Area:</strong> ' + (feature.properties['Shape_Area'] !== null ? autolinker.link(String(feature.properties['Shape_Area'])) : '') + ' m²</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function(e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }
        
        function style_BatasKecamatan_3_0() {
            return {
                pane: 'pane_BatasKecamatan_3',
                opacity: 1,
                color: 'rgba(208,208,208,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        
        map.createPane('pane_BatasKecamatan_3');
        map.getPane('pane_BatasKecamatan_3').style.zIndex = 403;
        map.getPane('pane_BatasKecamatan_3').style['mix-blend-mode'] = 'normal';
        var layer_BatasKecamatan_3 = new L.geoJson(json_BatasKecamatan_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_BatasKecamatan_3',
            layerName: 'layer_BatasKecamatan_3',
            pane: 'pane_BatasKecamatan_3',
            onEachFeature: pop_BatasKecamatan_3,
            style: style_BatasKecamatan_3_0,
        });
        bounds_group.addLayer(layer_BatasKecamatan_3);
        map.addLayer(layer_BatasKecamatan_3);
        
        // Tourism sites layer with image display
        function pop_SebaranObjekWisata_4(feature, layer) {
            // Create a dictionary of tourism site images
            // This should be replaced with your actual image URLs for each site
            var tourismImages = {
                "Curug Cimarinjung": ["https://simpan.ugm.ac.id/s/vNj2N3F7lpC3oNc/download"],
                "Curug Cikaso" : ["https://simpan.ugm.ac.id/s/XaA8yR60x0v6Z9k/download"],
                "Pantai Ujung Genteng": ["https://simpan.ugm.ac.id/s/4WC3XTEs3e7nMkb/download"],
                "Curug Sawer": ["https://simpan.ugm.ac.id/s/BXypj1UU9vpBPuW/download"], 
                "Geopark Ciletuh": ["https://simpan.ugm.ac.id/s/mbT6AAOvIofE9Qq/download"],
                "Jembatan Gantung Situ Gunung" : ["https://simpan.ugm.ac.id/s/njqGhS5dDDxWJM3/download"],
                "Bukit Karang Para" : ["https://simpan.ugm.ac.id/s/3dusWxYm5X7wvKN/download"],
                "Bukit Panenjoan Geopark" : ["https://simpan.ugm.ac.id/s/LzDSUl273zNucst/download"],
                "Bukit Teletubbies" : ["https://simpan.ugm.ac.id/s/sJ9orYYuKUNpZPE/download"],
                "Cakrawala View" : ["https://simpan.ugm.ac.id/s/ZtrniVUOu2LMpnQ/download"],
                "Curug Awang" : ["https://simpan.ugm.ac.id/s/1ktiMVpHwF3E3iM/download"],
                "Curug Bibijilan" : ["https://simpan.ugm.ac.id/s/E5nP1HpYPEcgrfk/download"],
                "Danau Situgunung" : ["https://simpan.ugm.ac.id/s/cIpoDM62QRbKpEd/download"],
                "Goalpara Tea Park" : ["https://simpan.ugm.ac.id/s/wjNwxtfqnJhYlPk/download"],
                "Gua Bumiayu" : ["https://simpan.ugm.ac.id/s/iLa2BL0pWYhMWIo/download"],
                "Gunung Tumpeng" : ["https://simpan.ugm.ac.id/s/O7QTDpBxbDyUU6i/download"],
                "Museum Megalodon" : ["https://simpan.ugm.ac.id/s/bLPkjAC7Aog1Ine/download"],
                "Pantai Cibangban" : ["https://simpan.ugm.ac.id/s/XvRzsnPeUPxxlnJ/download"],
                "Pantai Cimaja" : ["https://simpan.ugm.ac.id/s/1uDZFW7NgDFnU23/download"],
                "Pantai Karang Hawu" : ["https://simpan.ugm.ac.id/s/NufEtiQ6NfDwB41/download"],
                "Pantai Loji" : ["https://simpan.ugm.ac.id/s/68sEXAHaUL44bg2/download"],
                "Pantai Minajaya" : ["https://simpan.ugm.ac.id/s/68sEXAHaUL44bg2/download"],
                "Pantai Pelabuhan Ratu" : ["https://simpan.ugm.ac.id/s/3pM53AkPsjCuQZA/download"],
                "Puncak Darma" : ["https://simpan.ugm.ac.id/s/F6CjG259eoIUYVx/download"],
                "Ryzzy Azzahra Waterpark" : ["https://simpan.ugm.ac.id/s/6vh8Oql4598WAOF/download"],
                "SantaSea Water Theme Park Sukabumi" : ["https://simpan.ugm.ac.id/s/HZBZbyKWuKvU7Ah/download"],
                "Situ Batu Karut" : ["https://simpan.ugm.ac.id/s/9PvzK1NbEIYkNp5/download"],
                "Villa Cantik Sukabumi" : ["https://simpan.ugm.ac.id/s/VSEP9GmVyAyMCK9/download"],
                "Wisata Alam OASIS Sukabumi" : ["https://simpan.ugm.ac.id/s/Qm46wzvuYs2gGRt/download"],
                "Kampung Adat Ciptagelar" : ["https://simpan.ugm.ac.id/s/SySJKvdtc7NUoTI/download"],
                "Di Bawah Langit Selabintana" : ["https://simpan.ugm.ac.id/s/2Jr5imgNI2Cc3fD/download"],
                "Pondok halimun" : ["https://simpan.ugm.ac.id/s/zztsR5jTZp551Fj/download"]

                // Add more sites and their images as needed
            };
            
            // Default image if no specific image is found
            var defaultImage = "https://via.placeholder.com/400x300?text=No+Image+Available";
            
            // Get the site name
            var siteName = feature.properties['Nama Objek Wisata'] || 'Unknown Site';
            
            // Get images for this site or use default
            var images = tourismImages[siteName] || [defaultImage];
            
            // Create image HTML
            var imagesHtml = '';
            images.forEach(function(imageUrl) {
                imagesHtml += `<div class="popup-image-container">
                    <img src="${imageUrl}" class="popup-image" alt="${siteName}">
                </div>`;
            });
            
            var popupContent = `
                <div class="popup-title">${siteName}</div>
                ${imagesHtml}
                <table>
                    <tr>
                        <td colspan="2"><strong>Alamat:</strong> ${feature.properties['Alamat'] || 'Tidak tersedia'}</td>
                    </tr>
                    <tr>
                        <td colspan="2"><strong>Koordinat:</strong> ${feature.properties['Latitude'] || ''}, ${feature.properties['Longitude'] || ''}</td>
                    </tr>
                    <tr>
                        <td colspan="2"><strong>Deskripsi:</strong> ${feature.properties['Deskripsi'] || 'Wisata Paling Populer'}</td>
                    </tr>
                </table>
            `;
            
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            
            // Make popup larger to accommodate images
            var popupOptions = {
                maxWidth: 500,
                maxHeight: 600,
                className: 'custom-popup'
            };
            
            layer.on('popupopen', function(e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            
            layer.bindPopup(content, popupOptions);
        }
        
        function style_SebaranObjekWisata_4_0() {
            return {
                pane: 'pane_SebaranObjekWisata_4',
                radius: 6.0,  // Slightly larger radius for better visibility
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(23,243,255,1.0)',
                interactive: true,
            }
        }
        
        map.createPane('pane_SebaranObjekWisata_4');
        map.getPane('pane_SebaranObjekWisata_4').style.zIndex = 404;
        map.getPane('pane_SebaranObjekWisata_4').style['mix-blend-mode'] = 'normal';
        var layer_SebaranObjekWisata_4 = new L.geoJson(json_SebaranObjekWisata_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_SebaranObjekWisata_4',
            layerName: 'layer_SebaranObjekWisata_4',
            pane: 'pane_SebaranObjekWisata_4',
            onEachFeature: pop_SebaranObjekWisata_4,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_SebaranObjekWisata_4_0(feature));
            },
        });
        bounds_group.addLayer(layer_SebaranObjekWisata_4);
        map.addLayer(layer_SebaranObjekWisata_4);
        
        // Add search control
        var osmGeocoder = new L.Control.Geocoder({
            collapsed: true,
            position: 'topleft',
            text: 'Search',
            title: 'Search for location'
        }).addTo(map);
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0].className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0].title += 'Search for a place';
        
        // Layer control
        var overlaysTree = [
            {label: '<img src="legend/SebaranObjekWisata_4.png" /> Tourism Sites', layer: layer_SebaranObjekWisata_4},
            {label: '<img src="legend/BatasKecamatan_3.png" /> District Boundaries', layer: layer_BatasKecamatan_3},
            {label: '<img src="legend/JaringanJalan_2.png" /> Road Network', layer: layer_JaringanJalan_2},
            {label: "Slope Classification", layer: layer_KlasifikasiKemiringanLereng_1},
            {label: "ESRI Gray (light)", layer: layer_ESRIGraylight_0, radioGroup: 'bm' }
        ];
        
        var lay = L.control.layers.tree(null, overlaysTree, {
            collapsed: false,
        });
        lay.addTo(map);
        
        // Label handling
        document.addEventListener("DOMContentLoaded", function() {
            function newLayersListHeight() {
                var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                if (layerScrollbarElement) {
                    var layersListElement = document.querySelector('.leaflet-control-layers-list');
                    var originalHeight = layersListElement.style.height || window.getComputedStyle(layersListElement).height;
                    var newHeight = parseFloat(originalHeight) - 50;
                    layersListElement.style.height = newHeight + 'px';
                }
            }
            
            var isLayersListExpanded = true;
            var controlLayersElement = document.querySelector('.leaflet-control-layers');
            var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
            
            toggleLayerControl.addEventListener('click', function() {
                if (isLayersListExpanded) {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                } else {
                    controlLayersElement.classList.add('leaflet-control-layers-expanded');
                }
                isLayersListExpanded = !isLayersListExpanded;
                newLayersListHeight()
            });	
            
            if (controlLayersElement) {
                controlLayersElement.addEventListener('click', function(event) {
                    var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
                    if (toggleLayerHeaderPointer) {
                        newLayersListHeight();
                    }
                });
            }
            
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            
            var isSmallScreen = window.innerWidth < 650;
            if (isSmallScreen) {
                setTimeout(function() {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                    isLayersListExpanded = !isLayersListExpanded;
                }, 500);
            }  
        });
        
        setBounds();
        
        // Add labels to districts
        var i = 0;
        layer_BatasKecamatan_3.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['WADMKC'] !== null?String('<div style="color: #000000; font-size: 9pt; font-weight: bold; font-family: \'Arial\', sans-serif;">' + layer.feature.properties['WADMKC']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_BatasKecamatan_3'});
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });
        
        // Add labels to tourism sites
        var i = 0;
        layer_SebaranObjekWisata_4.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Nama Objek Wisata'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Arial\', sans-serif;">' + layer.feature.properties['Nama Objek Wisata']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_SebaranObjekWisata_4'});
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });
        
        // Extend ImageOverlay to get bounds
        L.ImageOverlay.include({
            getBounds: function () {
                return this._bounds;
            }
        });
        
        // Reset labels on zoom or layer changes
        resetLabels([layer_BatasKecamatan_3,layer_SebaranObjekWisata_4]);
        map.on("zoomend", function(){
            resetLabels([layer_BatasKecamatan_3,layer_SebaranObjekWisata_4]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_BatasKecamatan_3,layer_SebaranObjekWisata_4]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_BatasKecamatan_3,layer_SebaranObjekWisata_4]);
        });
        
        // Connect sidebar toggles to map layers
        document.getElementById('slopeLayer').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(layer_KlasifikasiKemiringanLereng_1);
            } else {
                map.removeLayer(layer_KlasifikasiKemiringanLereng_1);
            }
        });
        
        document.getElementById('roadLayer').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(layer_JaringanJalan_2);
            } else {
                map.removeLayer(layer_JaringanJalan_2);
            }
        });
        
        document.getElementById('districtLayer').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(layer_BatasKecamatan_3);
            } else {
                map.removeLayer(layer_BatasKecamatan_3);
            }
        });
        
        document.getElementById('tourismLayer').addEventListener('change', function(e) {
            if (e.target.checked) {
                map.addLayer(layer_SebaranObjekWisata_4);
            } else {
                map.removeLayer(layer_SebaranObjekWisata_4);
            }
        });
    </script>
</body>
</html>